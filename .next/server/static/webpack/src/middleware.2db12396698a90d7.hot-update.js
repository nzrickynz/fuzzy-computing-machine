"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("src/middleware",{

/***/ "(middleware)/./src/lib/auth.ts":
/*!*************************!*\
  !*** ./src/lib/auth.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   comparePasswords: () => (/* binding */ comparePasswords),\n/* harmony export */   createToken: () => (/* binding */ createToken),\n/* harmony export */   getToken: () => (/* binding */ getToken),\n/* harmony export */   getUser: () => (/* binding */ getUser),\n/* harmony export */   hashPassword: () => (/* binding */ hashPassword),\n/* harmony export */   removeUserCookie: () => (/* binding */ removeUserCookie),\n/* harmony export */   setUserCookie: () => (/* binding */ setUserCookie),\n/* harmony export */   verifyToken: () => (/* binding */ verifyToken)\n/* harmony export */ });\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(middleware)/./node_modules/jose/dist/browser/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(middleware)/./node_modules/next/dist/esm/api/headers.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(middleware)/./node_modules/bcryptjs/dist/bcrypt.js\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(bcryptjs__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nconst secret = new TextEncoder().encode(process.env.JWT_SECRET || \"your-secret-key\");\nasync function hashPassword(password) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().hash(password, 10);\n}\nasync function comparePasswords(password, hashedPassword) {\n    return bcryptjs__WEBPACK_IMPORTED_MODULE_1___default().compare(password, hashedPassword);\n}\nasync function createToken(userId) {\n    return await new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT({\n        userId\n    }).setProtectedHeader({\n        alg: \"HS256\"\n    }).setIssuedAt().setExpirationTime(\"24h\").sign(secret);\n}\nasync function verifyToken(token) {\n    try {\n        const verified = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, secret);\n        // Log the payload to see its structure\n        console.log(\"Token payload:\", verified.payload);\n        // Ensure we're getting a string\n        if (typeof verified.payload.userId !== \"string\") {\n            console.log(\"userId is not a string:\", verified.payload.userId);\n            return null;\n        }\n        return {\n            userId: verified.payload.userId\n        };\n    } catch (error) {\n        console.error(\"Token verification error:\", error);\n        return null;\n    }\n}\nasync function getUser() {\n    const token = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)().get(\"token\")?.value;\n    if (!token) return null;\n    return await verifyToken(token);\n}\nasync function getToken(request) {\n    const token = request.cookies.get(\"token\")?.value;\n    if (!token) return null;\n    return verifyToken(token);\n}\nasync function setUserCookie(token) {\n    (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)().set(\"token\", token, {\n        httpOnly: true,\n        secure: \"development\" === \"production\",\n        sameSite: \"lax\",\n        maxAge: 60 * 60 * 24\n    });\n}\nasync function removeUserCookie() {\n    (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)().delete(\"token\");\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKG1pZGRsZXdhcmUpLy4vc3JjL2xpYi9hdXRoLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBMEM7QUFDSDtBQUVUO0FBRTlCLE1BQU1JLFNBQVMsSUFBSUMsY0FBY0MsTUFBTSxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLFVBQVUsSUFBSTtBQUUzRCxlQUFlQyxhQUFhQyxRQUFnQjtJQUNqRCxPQUFPUixvREFBVyxDQUFDUSxVQUFVO0FBQy9CO0FBRU8sZUFBZUUsaUJBQ3BCRixRQUFnQixFQUNoQkcsY0FBc0I7SUFFdEIsT0FBT1gsdURBQWMsQ0FBQ1EsVUFBVUc7QUFDbEM7QUFFTyxlQUFlRSxZQUFZQyxNQUFjO0lBQzlDLE9BQU8sTUFBTSxJQUFJakIseUNBQU9BLENBQUM7UUFBRWlCO0lBQU8sR0FDL0JDLGtCQUFrQixDQUFDO1FBQUVDLEtBQUs7SUFBUSxHQUNsQ0MsV0FBVyxHQUNYQyxpQkFBaUIsQ0FBQyxPQUNsQkMsSUFBSSxDQUFDbEI7QUFDVjtBQUVPLGVBQWVtQixZQUFZQyxLQUFhO0lBQzdDLElBQUk7UUFDRixNQUFNQyxXQUFXLE1BQU14QiwrQ0FBU0EsQ0FBQ3VCLE9BQU9wQjtRQUN4Qyx1Q0FBdUM7UUFDdkNzQixRQUFRQyxHQUFHLENBQUMsa0JBQWtCRixTQUFTRyxPQUFPO1FBQzlDLGdDQUFnQztRQUNoQyxJQUFJLE9BQU9ILFNBQVNHLE9BQU8sQ0FBQ1gsTUFBTSxLQUFLLFVBQVU7WUFDL0NTLFFBQVFDLEdBQUcsQ0FBQywyQkFBMkJGLFNBQVNHLE9BQU8sQ0FBQ1gsTUFBTTtZQUM5RCxPQUFPO1FBQ1Q7UUFDQSxPQUFPO1lBQUVBLFFBQVFRLFNBQVNHLE9BQU8sQ0FBQ1gsTUFBTTtRQUFXO0lBQ3JELEVBQUUsT0FBT1ksT0FBTztRQUNkSCxRQUFRRyxLQUFLLENBQUMsNkJBQTZCQTtRQUMzQyxPQUFPO0lBQ1Q7QUFDRjtBQUVPLGVBQWVDO0lBQ3BCLE1BQU1OLFFBQVF0QixxREFBT0EsR0FBRzZCLEdBQUcsQ0FBQyxVQUFVQztJQUN0QyxJQUFJLENBQUNSLE9BQU8sT0FBTztJQUNuQixPQUFPLE1BQU1ELFlBQVlDO0FBQzNCO0FBRU8sZUFBZVMsU0FBU0MsT0FBb0I7SUFDakQsTUFBTVYsUUFBUVUsUUFBUWhDLE9BQU8sQ0FBQzZCLEdBQUcsQ0FBQyxVQUFVQztJQUM1QyxJQUFJLENBQUNSLE9BQU8sT0FBTztJQUNuQixPQUFPRCxZQUFZQztBQUNyQjtBQUVPLGVBQWVXLGNBQWNYLEtBQWE7SUFDL0N0QixxREFBT0EsR0FBR2tDLEdBQUcsQ0FBQyxTQUFTWixPQUFPO1FBQzVCYSxVQUFVO1FBQ1ZDLFFBQVEvQixrQkFBeUI7UUFDakNnQyxVQUFVO1FBQ1ZDLFFBQVEsS0FBSyxLQUFLO0lBQ3BCO0FBQ0Y7QUFFTyxlQUFlQztJQUNwQnZDLHFEQUFPQSxHQUFHd0MsTUFBTSxDQUFDO0FBQ25CIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9saWIvYXV0aC50cz82NjkyIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNpZ25KV1QsIGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnO1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycyc7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdCB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCBiY3J5cHQgZnJvbSAnYmNyeXB0anMnO1xuXG5jb25zdCBzZWNyZXQgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUocHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCB8fCAneW91ci1zZWNyZXQta2V5Jyk7XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYXNoUGFzc3dvcmQocGFzc3dvcmQ6IHN0cmluZyk6IFByb21pc2U8c3RyaW5nPiB7XG4gIHJldHVybiBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29tcGFyZVBhc3N3b3JkcyhcbiAgcGFzc3dvcmQ6IHN0cmluZyxcbiAgaGFzaGVkUGFzc3dvcmQ6IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIHJldHVybiBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgaGFzaGVkUGFzc3dvcmQpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVG9rZW4odXNlcklkOiBzdHJpbmcpIHtcbiAgcmV0dXJuIGF3YWl0IG5ldyBTaWduSldUKHsgdXNlcklkIH0pXG4gICAgLnNldFByb3RlY3RlZEhlYWRlcih7IGFsZzogJ0hTMjU2JyB9KVxuICAgIC5zZXRJc3N1ZWRBdCgpXG4gICAgLnNldEV4cGlyYXRpb25UaW1lKCcyNGgnKVxuICAgIC5zaWduKHNlY3JldCk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlUb2tlbih0b2tlbjogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdmVyaWZpZWQgPSBhd2FpdCBqd3RWZXJpZnkodG9rZW4sIHNlY3JldCk7XG4gICAgLy8gTG9nIHRoZSBwYXlsb2FkIHRvIHNlZSBpdHMgc3RydWN0dXJlXG4gICAgY29uc29sZS5sb2coJ1Rva2VuIHBheWxvYWQ6JywgdmVyaWZpZWQucGF5bG9hZCk7XG4gICAgLy8gRW5zdXJlIHdlJ3JlIGdldHRpbmcgYSBzdHJpbmdcbiAgICBpZiAodHlwZW9mIHZlcmlmaWVkLnBheWxvYWQudXNlcklkICE9PSAnc3RyaW5nJykge1xuICAgICAgY29uc29sZS5sb2coJ3VzZXJJZCBpcyBub3QgYSBzdHJpbmc6JywgdmVyaWZpZWQucGF5bG9hZC51c2VySWQpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB7IHVzZXJJZDogdmVyaWZpZWQucGF5bG9hZC51c2VySWQgYXMgc3RyaW5nIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignVG9rZW4gdmVyaWZpY2F0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VXNlcigpIHtcbiAgY29uc3QgdG9rZW4gPSBjb29raWVzKCkuZ2V0KCd0b2tlbicpPy52YWx1ZTtcbiAgaWYgKCF0b2tlbikgcmV0dXJuIG51bGw7XG4gIHJldHVybiBhd2FpdCB2ZXJpZnlUb2tlbih0b2tlbik7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRUb2tlbihyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCB0b2tlbiA9IHJlcXVlc3QuY29va2llcy5nZXQoJ3Rva2VuJyk/LnZhbHVlO1xuICBpZiAoIXRva2VuKSByZXR1cm4gbnVsbDtcbiAgcmV0dXJuIHZlcmlmeVRva2VuKHRva2VuKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldFVzZXJDb29raWUodG9rZW46IHN0cmluZykge1xuICBjb29raWVzKCkuc2V0KCd0b2tlbicsIHRva2VuLCB7XG4gICAgaHR0cE9ubHk6IHRydWUsXG4gICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgIHNhbWVTaXRlOiAnbGF4JyxcbiAgICBtYXhBZ2U6IDYwICogNjAgKiAyNCwgLy8gMjQgaG91cnNcbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZW1vdmVVc2VyQ29va2llKCkge1xuICBjb29raWVzKCkuZGVsZXRlKCd0b2tlbicpO1xufSAiXSwibmFtZXMiOlsiU2lnbkpXVCIsImp3dFZlcmlmeSIsImNvb2tpZXMiLCJiY3J5cHQiLCJzZWNyZXQiLCJUZXh0RW5jb2RlciIsImVuY29kZSIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwiaGFzaFBhc3N3b3JkIiwicGFzc3dvcmQiLCJoYXNoIiwiY29tcGFyZVBhc3N3b3JkcyIsImhhc2hlZFBhc3N3b3JkIiwiY29tcGFyZSIsImNyZWF0ZVRva2VuIiwidXNlcklkIiwic2V0UHJvdGVjdGVkSGVhZGVyIiwiYWxnIiwic2V0SXNzdWVkQXQiLCJzZXRFeHBpcmF0aW9uVGltZSIsInNpZ24iLCJ2ZXJpZnlUb2tlbiIsInRva2VuIiwidmVyaWZpZWQiLCJjb25zb2xlIiwibG9nIiwicGF5bG9hZCIsImVycm9yIiwiZ2V0VXNlciIsImdldCIsInZhbHVlIiwiZ2V0VG9rZW4iLCJyZXF1ZXN0Iiwic2V0VXNlckNvb2tpZSIsInNldCIsImh0dHBPbmx5Iiwic2VjdXJlIiwic2FtZVNpdGUiLCJtYXhBZ2UiLCJyZW1vdmVVc2VyQ29va2llIiwiZGVsZXRlIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(middleware)/./src/lib/auth.ts\n");

/***/ })

});